# Week 10: Advanced Linux Security & Incident Response Intro

## Learning Objectives

By the end of this week, cadets will be able to:
-   Understand the role of Pluggable Authentication Modules (PAM) and identify key configuration files.
-   Configure basic PAM settings for password quality and account lockout (building on Week 4).
-   Locate and analyze system logs using `journalctl` and traditional log files in `/var/log`.
-   Identify common Linux persistence mechanisms (cron jobs, systemd timers/services, startup scripts).
-   Apply basic incident response concepts within the Linux environment.
-   Apply learned techniques using `VM-Setup` scenarios.

## Topics Covered

-   **Pluggable Authentication Modules (PAM):**
    -   Purpose: Flexible framework for authentication, authorization, session management, password changes.
    -   Key Configuration Files: `/etc/pam.d/` directory (service-specific files like `sshd`, `login`, `sudo`), `/etc/security/` (module configurations like `pwquality.conf`).
    -   Common Modules: `pam_unix.so` (traditional password checks), `pam_pwquality.so` (password complexity), `pam_tally2.so` or `pam_faillock.so` (login failure tracking/lockout), `pam_permit.so`, `pam_deny.so`.
    -   Structure of PAM files: `type control module-path module-arguments`.
    -   Review/Enhance: Configuring password complexity (`/etc/pam.d/common-password` with `pam_pwquality.so`) and potentially account lockout (`pam_tally2` or `pam_faillock`).
-   **Linux Logging:**
    -   Systemd Journal (`journalctl`): Centralized logging system.
        -   Viewing logs: `journalctl`, `-f` (follow), `-u <service>` (filter by unit), `-p <priority>` (filter by priority err, warning, info), `--since`, `--until`.
        -   Checking boot logs: `journalctl -b`.
    -   Traditional Syslog (`/var/log/`):
        -   Common log files: `syslog` (general messages), `auth.log` (authentication events - logins, sudo), `kern.log` (kernel messages), `dpkg.log` (package installs/removals), `ufw.log` (firewall).
        -   Tools for viewing: `cat`, `less`, `tail -f`, `grep`.
    -   Using logs for forensic questions (e.g., finding login times, sudo usage, package installs).
-   **Linux Persistence Mechanisms:**
    -   Cron Jobs:
        -   User crontabs: `crontab -l` (list for current user), `crontab -e` (edit). Files typically in `/var/spool/cron/crontabs/`.
        -   System-wide cron: `/etc/crontab`, `/etc/cron.d/`, `/etc/cron.hourly/`, `/etc/cron.daily/`, `/etc/cron.weekly/`, `/etc/cron.monthly/`. Look for suspicious scripts/commands.
    -   Systemd Timers/Services:
        -   User services/timers: `~/.config/systemd/user/`.
        -   System services/timers: `/etc/systemd/system/`, `/usr/lib/systemd/system/`. Look for suspicious `.service` or `.timer` files. Commands: `systemctl list-timers --all`, `systemctl list-unit-files --type=service`.
    -   Startup Scripts: Files executed on login or boot.
        -   `/etc/profile`, `/etc/profile.d/*.sh`
        -   `~/.bashrc`, `~/.profile`, `~/.bash_profile`, `~/.bash_login`
        -   (Less common now) `/etc/rc.local` (may need enabling). Check for malicious commands added.
    -   SUID Binaries (Review from Week 6): `find / -perm /6000 -type f -ls`.
    -   (Mention others briefly: Rootkits, modified binaries - advanced).
-   **Incident Response (Linux Context):**
    -   Applying IR phases: Identifying suspicious processes (`ps`, `top`, `htop`), network connections (`ss`, `netstat`), cron jobs, services. Containing by killing processes, blocking IPs (UFW), disabling users. Eradicating by removing malicious files/scripts, fixing configs. Recovering by ensuring required services run.
-   **Practice with `VM-Setup`:**
    -   Using the `../VM-Setup/Linux/corporate-server-breach.sh` script to create compromised VMs.
    -   Applying investigation techniques (logs, cron, systemd, scripts) to find vulnerabilities and forensic answers described in the generated `README-Innovatech-Incident.txt`.

## Activities/Exercises

-   **Lab 1 (PAM):** Review `common-password`. If `pam_pwquality` is installed, examine its options. (Optional: Configure basic account lockout using `pam_tally2` or `pam_faillock` - requires careful setup).
-   **Lab 2 (Logging):** Use `journalctl` to view logs, filter by service (`sshd`) and time. Use `tail -f /var/log/auth.log` and perform logins/sudo actions to see live updates. Use `grep` to search logs for specific usernames or IPs.
-   **Lab 3 (Persistence):** Use `crontab -l` and check system cron directories. Use `systemctl list-timers --all`. Check `/etc/profile.d/` and `~/.bashrc` for suspicious entries.
-   **Lab 4 (IR Discussion):** Discuss how to investigate a suspicious process found running on Linux. What steps would you take? How does this fit the IR model?
-   **Exercise:** [Unique Linux IR Scenario](../Exercises/Linux/Incident_Response/README.md) - Use a VM generated by `../VM-Setup/Linux/`. Follow the generated README, investigate using logs, cron, systemd, etc., to identify IOCs, remove persistence, and answer forensic questions.

## Assessment

-   Participation in labs and investigation tasks.
-   Ability to locate common Linux persistence mechanisms.
-   Ability to use `journalctl` and `grep` to find basic information in logs.
-   Completion of [Unique Linux IR Scenario](../Exercises/Linux/Incident_Response/README.md).
-   [Unique Incident Response Quiz](../Quizzes/Quiz-Files/Incident_Response_Quiz.md) (Include Linux-specific questions)

## Resources

-   [Unique Linux Persistence Guide](../Linux/Guides/Persistence/README.md) (New or enhance existing)
-   [Unique Linux Logging Guide](../Linux/Guides/Logging/README.md) (New or enhance existing)
-   [Unique Linux PAM Guide](../Linux/Guides/PAM/README.md) (New or enhance existing)
-   [Unique Linux VM Setup README](../Linux/VM-Setup/README.md)
-   `pam.d`, `journalctl`, `crontab`, `systemd`, `grep` man pages.

---
*This weekly plan is uniquely designed for the Grissom JROTC CyberPatriot program.*
