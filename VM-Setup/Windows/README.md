# Windows VM Setup for CyberPatriot: "Enterprise Workstation Compromise" Scenario

This directory provides unique resources, primarily the `enterprise-workstation-setup.ps1` script, for creating a realistic, compromised Windows VM environment (Win 10/11 Pro/Enterprise) suitable for CyberPatriot incident response training.

## Understanding the Competition

CyberPatriot is best defined as an **incident response and remediation competition** where teams inherit a business computer network that has been compromised. Teams must:

1.  Identify unauthorized changes and security issues.
2.  Find and analyze forensic artifacts (answer README questions).
3.  Remove attacker persistence mechanisms.
4.  Apply security hardening to prevent future attacks while maintaining required services.

This script aims to create an environment reflecting this challenge.

## Overview

The `enterprise-workstation-setup.ps1` script transforms a clean Windows installation into a compromised workstation simulating a post-breach scenario (e.g., an HR machine, a developer workstation). Cadets must investigate the breach, identify how attackers gained and maintained access, remove malicious components, implement proper security controls according to a scenario README, and answer forensic questions.

## Scenario Features (Generated by Script - Examples)

*(These are examples; the actual script implements a specific set. Review the script for details.)*

-   **Unauthorized User Accounts:** Includes standard users, potentially hidden admin accounts (e.g., `adm1n$`), users added to sensitive groups.
-   **Weak Configurations:** Disabled/misconfigured firewall rules, weak password policies (via local policy), insecure service settings (e.g., Remote Registry enabled).
-   **Persistence Mechanisms:** Malicious scheduled tasks, registry run key entries (`HKLM\Run`, `HKCU\Run`), potentially a backdoored service (e.g., command path changed).
-   **Disabled/Misconfigured Security Features:** Windows Defender potentially disabled (real-time protection off, definitions outdated), UAC potentially lowered.
-   **Forensic Artifacts:** Log entries (simulated or resulting from script actions), files left behind (including a competition-style README), potentially modified system files (simulated), browser history hints (simulated).
-   **Competition README (`README-Incident.txt` - Generated by Script):** Placed on the Desktop, containing scenario, authorized users/apps, forensic questions, and rules.

## Setup Instructions

1.  **Prepare Base VM:**
    -   Start with a **clean** installation of Windows 10 or Windows 11 (Pro/Enterprise recommended).
    -   Ensure it's activated (if required).
    -   Install necessary drivers (especially network).
    -   Fully update the OS via Windows Update.
    -   Install VMware Tools or VirtualBox Guest Additions.
    -   **CRITICAL:** Take a VM snapshot named "Windows Clean Base - Updated YYYY-MM-DD".
2.  **Transfer Script:** Copy the `enterprise-workstation-setup.ps1` script to the **Clean Base** VM (e.g., to the Desktop).
3.  **Run Script:**
    -   Log in as the primary Administrator account on the VM.
    -   Open **PowerShell as Administrator**.
    -   Navigate to the script location: `cd $env:USERPROFILE\Desktop` (or wherever you saved it).
    -   Allow script execution for this session: `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process -Force`
    -   Execute the script: `.\enterprise-workstation-setup.ps1`
    -   The script will output progress and create a log file (e.g., `C:\setup_log_cyberpatriot.txt`). Review the log for errors.
4.  **Verify (Optional):** Briefly log in as a standard user (if created by script) or check a few key items (e.g., presence of README on Desktop, a new scheduled task) to ensure the script ran.
5.  **Shut Down:** Properly shut down the VM from within the OS.
6.  **Final Snapshot:** Take a VM snapshot named **"Compromised Scenario - Initial State - YYYY-MM-DD"** (or similar descriptive name). **This is the snapshot you distribute to cadets for practice.**

## Usage Instructions for Cadets

1.  Start the VM from the **"Compromised Scenario - Initial State"** snapshot provided by the instructor.
2.  Log in using the initial credentials provided in the scenario instructions (often mentioned within the script comments or instructor notes, e.g., `ITAdmin / Company2024!`).
3.  Locate and **carefully read** the competition-style README file placed on the Desktop (e.g., `README-Incident.txt`). This file contains the scenario, authorized users/services, **forensic questions**, and rules of engagement. **THIS IS YOUR PRIMARY GUIDE.**
4.  Investigate the system using standard tools (`eventvwr.msc`, `secpol.msc`, `services.msc`, `taskschd.msc`, `regedit.exe`, `wf.msc`, `lusrmgr.msc`, PowerShell commands like `Get-LocalUser`, `Get-ScheduledTask`, `Get-Service`, `Get-WinEvent`, etc.) and potentially audit scripts from `../../Windows/Scripts/`.
5.  Remediate vulnerabilities, remove persistence mechanisms, and harden the system according to the **README requirements** and security best practices.
6.  **Document findings and actions taken** using the Change Log template (`../../Resources/Templates/Change_Log_Template.md`).
7.  Answer the **forensic questions** using the Forensics template (`../../Resources/Templates/Forensics_Question_Response_Template.md`), citing evidence.

## Competition README (`README-Incident.txt` - Generated by Script)

The script creates a competition-style README file on the desktop that includes:
-   A scenario description (e.g., suspected compromise of an HR workstation).
-   Tasks for the incident response team (cadets).
-   List of authorized users and required services/applications.
-   Specific forensic questions requiring investigation.
-   (Optional) Fictional company security policy snippets relevant to the scenario.

This mimics the actual README files provided during CyberPatriot competition rounds and is essential reading.

## Customization

-   **Edit the `enterprise-workstation-setup.ps1` script** (make a backup first!) to change usernames, passwords, persistence methods, vulnerabilities introduced, or the content of the generated README.
-   Comment/uncomment sections within the script to enable/disable specific vulnerabilities.
-   Add new vulnerabilities or forensic clues relevant to your training goals. Ensure they align with CyberPatriot scope.
-   Create different versions of the script for varied scenarios.

## Troubleshooting

-   **Script Fails:** Check the PowerShell execution policy. Ensure the script is run as Administrator. Review the script log file (`C:\setup_log_cyberpatriot.txt`) for specific errors. Ensure the base VM OS is compatible (Win 10/11 Pro/Ent).
-   **Unexpected Behavior:** Verify the base VM was clean and updated before running the script. Ensure no conflicting software was pre-installed.

## Effective Training Approach

Based on the experiences of successful CyberPatriot teams, here are key strategies for effective training using this VM:

### 1. Develop the Security Mindset
Focus on understanding *why* vulnerabilities exist and *how* attackers exploit them, not just applying fixes from a checklist. Treat it as a real incident.

### 2. Baselining Strategy
Train cadets to compare the compromised VM against documentation, checklists, or output from audit scripts run early to identify deviations:
-   Unauthorized user accounts/groups
-   Unusual running services/processes
-   Modified registry entries (especially Run keys)
-   Suspicious scheduled tasks
-   Unexpected network connections/firewall rules
-   Disabled security features (Defender, Firewall, UAC)

### 3. Operating System Familiarity
Encourage deep dives into Windows internals: Registry structure, GPO processing, service dependencies, event log meanings, PowerShell scripting for automation and querying.

### 4. Structured Approach
During practice, follow a methodical process (adapt based on README):
1.  Review README and forensic questions thoroughly.
2.  Perform initial reconnaissance (users, groups, services, processes, network, tasks, startup). Document initial state.
3.  Address critical user account issues (unauthorized admins, weak passwords).
4.  Hunt for persistence (startup items, scheduled tasks, service changes, registry keys).
5.  Remediate vulnerabilities (policies, services, software removal).
6.  Enable/configure security features (Defender, Firewall, Auditing).
7.  Answer forensic questions based on evidence found.
8.  Document everything meticulously in the Change Log.

---
*This scenario and script are unique and designed for CyberPatriot training only. Adapt and enhance for your team's needs.*
